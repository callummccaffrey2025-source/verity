'use client';

import Link from 'next/link';

type MP = any;

export function MPCard({ mp }: { mp: MP }) {
  const m = mp ?? {};
  const name = m.name ?? 'Unknown';
  const party =
    m.party ?? m.party_short ?? m.partyCode ?? m.party_code ?? '';
  const chamber = m.house ?? m.chamber ?? '';
  const electorate = m.electorate ?? m.state ?? '';
  const slug =
    m.slug ??
    (name
      ? name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '')
      : '');
  const href = slug ? `/mps/${slug}` : '/mps';

  const portraitUrl = m.portrait_url || m.portraitUrl || null;

  const att12 = m.attendance_12m ?? m.att12 ?? null;
  const attOverall = m.attendance_overall ?? m.attOverall ?? null;
  const rebellions12m = m.rebellions_12m ?? m.rebellions12m ?? 0;
  const committees =
    Array.isArray(m.committees) ? m.committees.length : (m.committees ?? 0);

  const tag = [party, chamber, electorate].filter(Boolean).join(' · ');
  const fmtPct = (v: any) =>
    v === null || v === undefined || v === '' ? '—' : `${v}%`;

  return (
    <article className="rounded-xl border border-zinc-800 bg-zinc-900 p-4 transition hover:border-zinc-700 focus-within:ring-1 focus-within:ring-emerald-500">
      <div className="flex items-center gap-3">
        {portraitUrl ? (
          <img
            src={portraitUrl}
            alt={`${name} portrait`}
            className="h-12 w-10 rounded-md object-cover"
          />
        ) : (
          <div className="h-12 w-10 rounded-md bg-zinc-800/60" aria-hidden />
        )}

        <div className="min-w-0">
          <h3 className="truncate font-medium">{name}</h3>
          <p className="truncate text-xs text-zinc-400">{tag}</p>
        </div>
      </div>

      <div className="mt-3 grid grid-cols-2 gap-3 text-sm text-zinc-300 md:grid-cols-4">
        <div>
          <div className="text-[11px] uppercase tracking-wide text-zinc-400">
            Attendance (12m)
          </div>
          <div className="font-medium text-zinc-100">{fmtPct(att12)}</div>
        </div>
        <div>
          <div className="text-[11px] uppercase tracking-wide text-zinc-400">
            Overall attendance
          </div>
          <div className="font-medium text-zinc-100">{fmtPct(attOverall)}</div>
        </div>
        <div>
          <div className="text-[11px] uppercase tracking-wide text-zinc-400">
            Rebellions (12m)
          </div>
          <div className="font-medium text-zinc-100">
            {Number.isFinite(rebellions12m) ? rebellions12m : 0}
          </div>
        </div>
        <div>
          <div className="text-[11px] uppercase tracking-wide text-zinc-400">
            Committees
          </div>
          <div className="font-medium text-zinc-100">
            {Number.isFinite(committees) ? committees : 0}
          </div>
        </div>
      </div>

      <div className="mt-3">
        <Link
          href={href}
          aria-label={`Open profile for ${name || 'MP'}`}
          className="inline-flex items-center gap-1 text-emerald-300 text-sm hover:underline"
        >
          <span>Open profile</span>
          <span aria-hidden>→</span>
        </Link>
      </div>
    </article>
  );
}

export default MPCard;
